<?xml version="1.0" encoding="UTF-8"?>
<!-- Â© 2016 ClearCorp
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html). -->

<odoo>
    <!-- Adds invoiced and issue_type fields -->
    <record model="ir.ui.view" id="project_issue_form_view_type">
        <field name="name">Project Issue Tracker Form</field>
        <field name="model">project.issue</field>
        <field name="inherit_id" ref="project_issue.project_issue_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//form/sheet/group/group/field[@name='user_id']" position="before">
                <field name="invoiced"/>
                <field name="issue_type"/>
            </xpath>
        </field>
    </record>

    <!-- Adds ticket configuration to sale subscription form. It also allows
    the user to change the associated analytic account, so that it refers
    to a specific client. -->
    <record id="subscription_view_issue_type_form" model="ir.ui.view">
        <field name="name">Issue View</field>
        <field name="model">sale.subscription</field>
        <field name="priority" eval="160"/>
        <field name="inherit_id" ref="sale_contract.sale_subscription_view_form"/>
        <field name="arch" type="xml">
            <!-- Adds the ticket configuration page -->
            <xpath expr="//notebook" position="inside">
                <page string="Ticket Configuration" name="tickets_page" >
                    <label for="ticket_invoice_type_ids" string="Ticket Type" class="oe_inline"/>
                    <field name="ticket_invoice_type_ids" string="Ticket Type">
                        <tree editable="bottom">
                            <field name="name"/>
                            <field name="warranty"/>
                        </tree>
                    </field>
                </page>
            </xpath>

            <!-- Allows the edition of the related analytic account (the client's account). -->
            <xpath expr="//notebook/page/group/field[@name='analytic_account_id']" position="attributes">
                <attribute name="readonly">0</attribute>
            </xpath>
        </field>
    </record>

    <!-- Allows the creation and editing of new issue types -->
    <record id="action_issue_type" model="ir.actions.act_window">
        <field name="name">Issue Types</field>
        <field name="res_model">ticket.invoice.type</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Adds Issue Type item to menu -->
    <menuitem id="issue_work_type" name="Issue Types" parent="project.menu_project_config" sequence="50" action="action_issue_type"/>
</odoo>