<?xml version="1.0" encoding="UTF-8"?>
<!-- Â© 2016 ClearCorp
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html). -->

<odoo>
    <!-- Adds quote states to project.scrum.feature -->
    <!--
    <record id="view_feature_form" model="ir.ui.view">
        <field name="name">Feature View Form</field>
        <field name="model">project.scrum.feature</field>
        <field name="inherit_id" ref="project_scrum_method.view_feature_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form/header/button[@name='set_cancel']"
                position="after">
                <button name="set_quote_pending" type="object"
                    string="Quote Pending" class="oe_highlight"/>
                <button name="set_quoted" type="object"
                    string="Quoted" />
            </xpath>
            <! Same view, other model -->
            <!--xpath expr="//page[@name='description']" position="after">
                <field name="ticket_id" widget="one2many_list"/>
            </xpath>
        </field>
    </record-->

    <!-- Adds approvals to issue tracking-view -->
    <record model="ir.ui.view" id="project_issue_form_view_invoice">
        <field name="name">Project Issue Tracker Form Approvals</field>
        <field name="model">project.issue</field>
        <field name="inherit_id" ref="project_issue.project_issue_form_view"/>
        <field name="priority" eval="150" />
        <field name="arch" type="xml">
            <xpath expr="//notebook/page[@name='extra_info']" position="before">
                <page string="Approvals" name="issue_approvals">
                    <h3><label for="feature_id" string="Related Feature" class="oe_inline"/></h3>
                    <field name="feature_id" string="Feature" required="1"
                           context="{
                            'default_project_id': project_id,
                            'default_partner_id': partner_id,
                            'default_state': 'draft'
                           }"/>
                    <field name="prepaid_hours_approval_id" widget="one2many_list" mode="tree" attrs="{'readonly': [('feature_id', '=', False)]}"
                           context="{
                            'default_ticket_id': active_id,
                            'default_user_id': partner_id
                            }">
                        <tree string="Approvals" name="approvals">
                            <field name="user_id"/>
                            <field name="date"/>
                            <field name="sequence"/>
                            <field name="state" widget="selection"/>
                        </tree>
                        <form>
                            <group>
                                <group>
                                    <field name="user_id"/>
                                    <field name="date"/>
                                </group>
                                <group>
                                    <field name="sequence"/>
                                    <field name="state" widget="selection"/>
                                </group>
                                <field name="approval_line_ids" widget="one2many_list" mode="tree">
                                    <tree string="Approval Lines" editable="bottom">
                                        <field name="prepaid_hours_id"/>
                                        <field name="work_type_id"/>
                                        <field name="requested_hours"/>
                                    </tree>
                                </field>
                                <group>
                                    <button string="Start Proposal" type="object" name="create_approval_line"/>
                                </group>
                                <field name="approval_values" widget="one2many_list" mode="tree">
                                    <tree>
                                        <field name="prepaid_hours_id" readonly="1"/>
                                        <field name="prepaid_hours" readonly="1"/>
                                        <field name="time_already_approved" readonly="1"/>
                                        <field name="remaining_hours" readonly="1"/>
                                        <field name="hours_to_be_approved" readonly="1"/>
                                        <field name="requested_hours" readonly="1"/>
                                        <field name="extra_hours" readonly="1"/>
                                        <field name="extra_amount" readonly="1"/>
                                    </tree>
                                </field>
                                <group>
                                    <button string="Fill proposal values" type="object" name="fill_proposed_hour_values"/>
                                </group>
                            </group>
                        </form>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
